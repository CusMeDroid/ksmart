<!DOCTYPE html>
<html lang="id-ID">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>KSMART MASUK/DAFTAR</title>
    <script src="https://www.gstatic.com/firebasejs/8.4.2/firebase.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.4.2/firebase-auth.js"></script>
  </head>
  <body>
    <h1>Masuk</h1>
    <lable>Email</lable><br>
    <input type="email" placeholder="E-mail" id="email-login"><br><br>
    <lable>Kata Sandi</lable><br>
    <input type="password" placeholder="********" id="pass-login"><br><br>
    <button id="btn-login">Masuk</button>
    
    <h1>Daftar</h1>
    <lable>Email</lable><br>
    <input type="email" placeholder="E-mail" id="email-regis"><br><br>
    <lable>Kata Sandi</lable><br>
    <input type="password" placeholder="********" id="pass-regis"><br><br>
    <button id="btn-regis">Daftar</button>

    <script src="js/config/index.js"></script>
    <script src="js/storage/index.js"></script>
    <script>
      if (sessionEmail && sessionUid) {
        window.location.href = "./";
      }
      document.getElementById("btn-login").onclick = function () {
        var mEmail_login = document.getElementById("email-login").value;
        var mPass_login = document.getElementById("pass-login").value;
        if (mEmail_login < 1 || mPass_login < 1) {
          alert("Jangan kosong");
        } else {
          firebase.auth().signInWithEmailAndPassword(mEmail_login, mPass_login)
          .then((userCredential) => {
            // Signed in
            var user = userCredential.user;
            sessionEmail = mEmail_login;
            localStorage.setItem("email", JSON.stringify(sessionEmail));
            sessionUid = user.uid;
            localStorage.setItem("uid", JSON.stringify(sessionUid));
            alert("Selamat Datang Kembali");
            window.location.href = "";
          })
          .catch((error) => {
            var errorCode = error.code;
            var errorMessage = error.message;
            alert("Galat! "+errorMessage);
            document.getElementById("email-login").value="";
            document.getElementById("pass-login").value="";
          });
        }
      };
      
      document.getElementById("btn-regis").onclick = function () {
        var mEmail_regis = document.getElementById("email-regis").value;
        var mPass_regis = document.getElementById("pass-regis").value;
        if (mEmail_regis < 1 || mPass_regis < 1) {
          alert("Jangan kosong");
        } else {
          firebase.auth().createUserWithEmailAndPassword(mEmail_regis, mPass_regis)
          .then((userCredential) => {
            // Signed in 
            var user = userCredential.user;
            firebase
              .database()
              .ref("users/"+user.uid)
              .update({
                email: mEmail_regis,
              });
            alert("Selamat Datang");
            sessionEmail = mEmail_regis;
            localStorage.setItem("email", JSON.stringify(sessionEmail));
            sessionUid = user.uid;
            localStorage.setItem("uid", JSON.stringify(sessionUid));
            window.location.href = "";
          })
          .catch((error) => {
            var errorCode = error.code;
            var errorMessage = error.message;
            alert("Galat! "+errorMessage);
            document.getElementById("email-regis").value="";
            document.getElementById("pass-regis").value="";
          });
        }
      };
    </script>
    
  </body>
</html>
